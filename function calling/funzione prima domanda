<?php
// Imposta il fuso orario
date_default_timezone_set('Europe/Rome');

// Percorso del file CSV
$file = 'C:/Users/gallu/Downloads/ricavi.csv';

// Controlla se il file esiste
if (!file_exists($file)) {
    die("File non trovato!");
}

$data = [];
if (($handle = fopen($file, "r")) !== false) {
    $header = fgetcsv($handle); // Legge l'intestazione

    while (($row = fgetcsv($handle)) !== false) {
        $record = array_combine($header, $row);

        // Parsing dei dati
        $siteid = $record['siteid'];
        $earnings = (float)$record['earnings'];

        if (!isset($data[$siteid])) {
            $data[$siteid] = 0;
        }

        $data[$siteid] += $earnings;
    }

    fclose($handle);
}

// Ordina i siti per ricavi totali decrescenti
arsort($data);

// Prendi i top 10
$top10 = array_slice($data, 0, 10, true);

// Stampa tabella HTML
echo "<h2>Top 10 siti per ricavi totali (dal dataset completo)</h2>";
echo "<table border='1' cellpadding='6' cellspacing='0'>";
echo "<tr style='background-color:#f0f0f0;'>
        <th>Posizione</th>
        <th>Site ID</th>
        <th>Ricavi Totali (â‚¬)</th>
      </tr>";

$posizione = 1;
foreach ($top10 as $siteid => $ricavi) {
    echo "<tr>";
    echo "<td>{$posizione}</td>";
    echo "<td>{$siteid}</td>";
    echo "<td><strong>" . number_format($ricavi, 2, ',', '.') . "</strong></td>";
    echo "</tr>";
    $posizione++;
}

echo "</table>";
?>
